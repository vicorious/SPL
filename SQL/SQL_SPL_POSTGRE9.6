-- TABLAS
CREATE TABLE ENTIDAD
(
    ID 					INT PRIMARY KEY,
    ATRIBUTO_VARCHAR 	TEXT,
    ATRIBUTO_ENTERO 	INT,
    ATRIBUTO_DATE 		DATE,
    ENTIDAD_2_FOREIGN 	INTEGER    
);

CREATE TABLE ENTIDAD_2
(
    ID_ENTIDAD_2 	 	INT PRIMARY KEY,
    ATRIBUTO_VARCHAR 	TEXT,
    ATRIBUTO_DECIMAL	DECIMAL	
);

ALTER TABLE ENTIDAD
ADD CONSTRAINT fk_entidad_2
FOREIGN KEY(ENTIDAD_2_FOREIGN)
REFERENCES ENTIDAD_2 (ID_ENTIDAD_2);

CREATE TABLE USUARIO
(
    ID 					INT PRIMARY KEY,
    NOMBRE 				TEXT,
    APELLIDOS 			TEXT,
    CORREO 				TEXT,
    CONTRASENA 			TEXT,
);

CREATE TABLE PARAMETRO
(
    ID 			INT PRIMARY KEY,
    LLAVE 		TEXT,
    VALOR 		TEXT    
);

CREATE TABLE PEDIDO
(
    id integer NOT NULL,
    usuario_direccion_id integer,
    forma_pago_id integer,
    codigo text COLLATE pg_catalog."default" NOT NULL,
    c_precio_total integer,
    fecha_inicial_pedido timestamp without time zone,
    fecha_final_pedido timestamp without time zone,
    CONSTRAINT pedido_pkey PRIMARY KEY (id),
    CONSTRAINT fk_forma_pago FOREIGN KEY (forma_pago_id)
        REFERENCES public.forma_pago (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
);

CREATE TABLE FORMA_PAGO
(
    id integer NOT NULL,
    codigo text COLLATE pg_catalog."default" NOT NULL,
    valor text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT forma_pago_pkey PRIMARY KEY (id)
);

--- OBJETOS VARIOS (SECUENCIAS, PROCEDIMIENTOS, FUNCIONES) ---

CREATE SEQUENCE USUARIO_SECUENCIA
    CYCLE
    INCREMENT 1
    START 1
    MINVALUE 1
    MAXVALUE 999999999999
    CACHE 1;
	
----

CREATE OR REPLACE FUNCTION ADD(
	integer,
	integer)
    RETURNS integer
    LANGUAGE 'sql'

    COST 100
    IMMUTABLE STRICT 
    ROWS 0
AS $BODY$
select $1 + $2;
$BODY$;